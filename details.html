<!DOCTYPE HTML>
<html>
	<head>
		<title>Fitness Express OZ</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

		<!-- FontAwesome - http://fortawesome.github.io/Font-Awesome/ -->
		<link rel="stylesheet" href="css/font-awesome.min.css" />

		<!-- jQueryMobileCSS - original without styling -->
		<link rel="stylesheet" href="css/jquerymobile.css" />

		<!-- nativeDroid core CSS -->
		<link rel="stylesheet" href="css/jquerymobile.nativedroid.css" />

		<!-- nativeDroid: Light/Dark -->
		<link rel="stylesheet" href="css/jquerymobile.nativedroid.dark.css"  id='jQMnDTheme' />

		<!-- nativeDroid: Color Schemes -->
		<link rel="stylesheet" href="css/jquerymobile.nativedroid.color.green.css" id='jQMnDColor' />

		<!--custom css-->
		<link rel="stylesheet" href="css/style.css" />
		<!-- <link rel="stylesheet" href="css/media-query.css" /> -->
		<!-- jQuery / jQueryMobile Scripts -->
		<script src="js/jquery-1.10.2.min.js"></script>
      <script src="js/jquery.mobile-1.4.2.min.js"></script>
		
    <script type="text/javascript" src="js/jquery.jqplot.min.js"></script>
        <script type="text/javascript" src="js/jqplot.logAxisRenderer.min.js"></script>
        <script type="text/javascript" src="js/jqplot.canvasTextRenderer.min.js"></script>
    <script type="text/javascript" src="js/jqplot.dateAxisRenderer.min.js"></script>
        <script type="text/javascript" src="js/jqplot.canvasAxisLabelRenderer.min.js"></script>
    <script type="text/javascript" src="js/jqplot.canvasAxisTickRenderer.min.js"></script>
        <script type="text/javascript" src="js/jqplot.categoryAxisRenderer.min.js"></script>
        <script type="text/javascript" src="js/jqplot.highlighter.min.js"></script>
        <script type="text/javascript" src="js/jqplot.cursor.min.js"></script>

        <link rel="stylesheet" type="text/css" hrf="css/jquery.jqplot.min.css" />

    <script src="js/cordova.js"></script>
		<script src="js/functions.js"></script>

		<script class="code" type="text/javascript">

      $(document).on("pagecreate","#details-page",function(){
      	allowAccess();
      		
        $( ".footer" ).toolbar({ tapToggle: false });
        
      	//get value from the link		
        var assessment_info = window.location.search.substring(1);	
        var res = assessment_info.replace("+"," ");
        
        var values=res.split('=');
        var assessment_name=values[0]; 
        var assessment_id=values[1];

        var assessmentMessage = '<i class="icon-eye-open"></i> '+assessment_name + ' Graph';

        $("#pageTitle").html(assessmentMessage);
        //alert(assessment_name);

        var userId = User.id;
        
        var getaddress_url = serviceURL + "users/assessmentcurvedata/";
                  var info = {
                   'data' : { 'assessmentName' : assessment_name, 'assessmentId' : assessment_id, 'userId' : userId},
                   'callback' : 'callbackresult'
                  };
                  getAjaxData(getaddress_url, info, 'callbackresult');
        
        
      });
    	function callbackresult(data) {
    
 //console.log(data.data);
 var graph_information = data.data.data;
 
 var len = data.data.data.length;

 //alert(len);
  var noRecord = "<p>"+'No record found for you!'+"</p>"
if(len == 0){
  $("#chart1").html(noRecord);
 }
 else{
 
var result = [];
var dateValue = null;
var assessmentValue = null;
//$(".jqplot-highlighter-tooltip").css("color","black");
var temp = null;
  for(var i=0;i<len;i++){
    dateValue = graph_information[i].AssessmentsUser.assessment_date;
    assessmentValue = graph_information[i].AssessmentsUser.assessment;
    //alert(dateValue);

    temp = [];

    temp.push(dateValue);
    temp.push(parseInt(assessmentValue));

    result.push(temp);
  
  }
  console.log(result);
  
  var min_date = graph_information[0].AssessmentsUser.assessment_date;
  function incr_date(date_str){
  var parts = date_str.split("-");
  var dt = new Date(
    parseInt(parts[0], 10),      // year
    parseInt(parts[1], 10) - 1,  // month (starts with 0)
    parseInt(parts[2], 10)       // date
  );
  dt.setDate(dt.getDate() - 1);
  parts[0] = "" + dt.getFullYear();
  parts[1] = "" + (dt.getMonth() + 1);
  if (parts[1].length < 2) {
    parts[1] = "0" + parts[1];
  }
  parts[2] = "" + dt.getDate();
  if (parts[2].length < 2) {
    parts[2] = "0" + parts[2];
  }
  return parts.join("-");
}

var changed_date = incr_date(min_date);

//alert(changed_date);

  var line1=result;
  var plot1 = $.jqplot('chart1', [line1], {
    title:'Assessment Per Date Graph',
    axes:{
        xaxis:{
            renderer:$.jqplot.DateAxisRenderer,
      //tickOptions:{formatString:'%b %#d, %y'},
          min:changed_date, 
          tickInterval:'7 day',
          //label: 'Date of Assessment',
          labelRenderer: $.jqplot.CanvasAxisLabelRenderer,
          tickRenderer: $.jqplot.CanvasAxisTickRenderer,
          tickOptions: {
              // labelPosition: 'middle',
              fontSize:'10pt', 
              textColor:'#fff',
              angle: -45
          },
      pad: 1 
        },
    yaxis:{
      //label:'Assessments'
        }
    },
    series:[{lineWidth:2, markerOptions:{style:'square'}}],
  
    highlighter: {
        show: true,
        sizeAdjust: 5.5
      },
      cursor: {
        show: false
      }
  });
}
}
</script>
	</head>
	<body>
		<div data-role="page" id="details-page" data-theme='b'>
		<div id="page_wrapper">
			<div data-role="header" data-position="fixed" data-tap-toggle="false" data-theme='b'>
				<a href="#">
					<img src="image/logo.png" alt="logo" />
				</a>
				<h1>Fitness Express OZ</h1>
			</div>
			<div data-role="content">
        <div class="top-section">		
					<div id="pageTitle"></div>
          <div id="goback">
              <i class="icon-step-backward"></i>
              <a href="assessment.html" data-role="none" data-ajax="false">Go Back</a>
          </div>
        </div>
          <div id="assessment_name" data-role="list-divider"></div>
          <div id="chart1" style="height:300px; width:auto; margin: 0 auto;"></div>
			</div>
			<div data-role="footer" data-position="fixed" data-id="foo1" class="footer">
				<div class="social-i" align="middle">
					<a href="https://www.facebook.com/FitExpressOz"><i class='icon-facebook'></i></a>
					<a href="http://instagram.com/fitnessexpress_oz"><i class='icon-instagram'></i></a>
					<a href="mailto:info@fitnessexpressoz.com" target="_top"><i class='icon-envelope-alt'></i></a>
				</div>
				<div class="" align="middle">
					Ph: 1300 00 9777
				</div>
			</div>
		</div>
		</div>
	</body>
</html>
